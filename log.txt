CUDA_VISIBLE_DEVICES=1,2,3,4,5
2019-03-01 21:52:28.818576: I tensorflow/core/platform/cpu_feature_guard.cc:141] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 FMA
WARNING:root:
DeepCTR version 0.3.1 detected. Your version is 0.3.0.
Use `pip install -U deepctr` to upgrade.Changelog: https://github.com/shenweichen/DeepCTR/releases/tag/v0.3.1
2019-03-01 21:52:33.238795: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1392] Found device 0 with properties: 
name: GeForce GTX 1080 Ti major: 6 minor: 1 memoryClockRate(GHz): 1.582
pciBusID: 0000:05:00.0
totalMemory: 10.92GiB freeMemory: 10.76GiB
2019-03-01 21:52:33.485085: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1392] Found device 1 with properties: 
name: GeForce GTX 1080 Ti major: 6 minor: 1 memoryClockRate(GHz): 1.582
pciBusID: 0000:08:00.0
totalMemory: 10.92GiB freeMemory: 10.76GiB
2019-03-01 21:52:33.744806: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1392] Found device 2 with properties: 
name: GeForce GTX 1080 Ti major: 6 minor: 1 memoryClockRate(GHz): 1.582
pciBusID: 0000:09:00.0
totalMemory: 10.92GiB freeMemory: 10.76GiB
2019-03-01 21:52:33.964061: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1392] Found device 3 with properties: 
name: GeForce GTX 1080 Ti major: 6 minor: 1 memoryClockRate(GHz): 1.582
pciBusID: 0000:85:00.0
totalMemory: 10.92GiB freeMemory: 10.76GiB
2019-03-01 21:52:34.201051: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1392] Found device 4 with properties: 
name: GeForce GTX 1080 Ti major: 6 minor: 1 memoryClockRate(GHz): 1.582
pciBusID: 0000:86:00.0
totalMemory: 10.92GiB freeMemory: 10.76GiB
2019-03-01 21:52:34.206853: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1471] Adding visible gpu devices: 0, 1, 2, 3, 4
2019-03-01 21:52:35.930849: I tensorflow/core/common_runtime/gpu/gpu_device.cc:952] Device interconnect StreamExecutor with strength 1 edge matrix:
2019-03-01 21:52:35.930899: I tensorflow/core/common_runtime/gpu/gpu_device.cc:958]      0 1 2 3 4 
2019-03-01 21:52:35.930910: I tensorflow/core/common_runtime/gpu/gpu_device.cc:971] 0:   N Y Y N N 
2019-03-01 21:52:35.930918: I tensorflow/core/common_runtime/gpu/gpu_device.cc:971] 1:   Y N Y N N 
2019-03-01 21:52:35.930925: I tensorflow/core/common_runtime/gpu/gpu_device.cc:971] 2:   Y Y N N N 
2019-03-01 21:52:35.930932: I tensorflow/core/common_runtime/gpu/gpu_device.cc:971] 3:   N N N N Y 
2019-03-01 21:52:35.930940: I tensorflow/core/common_runtime/gpu/gpu_device.cc:971] 4:   N N N Y N 
2019-03-01 21:52:35.932173: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1084] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 10409 MB memory) -> physical GPU (device: 0, name: GeForce GTX 1080 Ti, pci bus id: 0000:05:00.0, compute capability: 6.1)
2019-03-01 21:52:35.933469: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1084] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:1 with 10409 MB memory) -> physical GPU (device: 1, name: GeForce GTX 1080 Ti, pci bus id: 0000:08:00.0, compute capability: 6.1)
2019-03-01 21:52:35.935422: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1084] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:2 with 10409 MB memory) -> physical GPU (device: 2, name: GeForce GTX 1080 Ti, pci bus id: 0000:09:00.0, compute capability: 6.1)
2019-03-01 21:52:35.936680: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1084] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:3 with 10409 MB memory) -> physical GPU (device: 3, name: GeForce GTX 1080 Ti, pci bus id: 0000:85:00.0, compute capability: 6.1)
2019-03-01 21:52:35.937697: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1084] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:4 with 10409 MB memory) -> physical GPU (device: 4, name: GeForce GTX 1080 Ti, pci bus id: 0000:86:00.0, compute capability: 6.1)
==== before model build ===
[xdeepfm] feature_dim_dict: {'sparse': [SingleFeat(name='uid', dimension=670000), SingleFeat(name='item_id', dimension=32000000), SingleFeat(name='author_id', dimension=15000000), SingleFeat(name='item_city', dimension=500), SingleFeat(name='channel', dimension=6), SingleFeat(name='music_id', dimension=7800000), SingleFeat(name='device', dimension=5000)], 'dense': [SingleFeat(name='duration_time', dimension=0)]}


[preprocess_input_embedding] sparse_input_dict: OrderedDict([('uid', <tf.Tensor 'sparse_0-uid:0' shape=(?, 1) dtype=float32>), ('item_id', <tf.Tensor 'sparse_1-item_id:0' shape=(?, 1) dtype=float32>), ('author_id', <tf.Tensor 'sparse_2-author_id:0' shape=(?, 1) dtype=float32>), ('item_city', <tf.Tensor 'sparse_3-item_city:0' shape=(?, 1) dtype=float32>), ('channel', <tf.Tensor 'sparse_4-channel:0' shape=(?, 1) dtype=float32>), ('music_id', <tf.Tensor 'sparse_5-music_id:0' shape=(?, 1) dtype=float32>), ('device', <tf.Tensor 'sparse_6-device:0' shape=(?, 1) dtype=float32>)])
[preprocess_input_embedding] dense_input_dict: OrderedDict([(SingleFeat(name='duration_time', dimension=0), <tf.Tensor 'dense_0-duration_time:0' shape=(?, 1) dtype=float32>)])
[preprocess_input_embedding] hash_input_dict: {'uid': <tf.Tensor 'lambda/mod:0' shape=(?, 1) dtype=float32>, 'item_id': <tf.Tensor 'lambda_1/mod:0' shape=(?, 1) dtype=float32>, 'author_id': <tf.Tensor 'lambda_2/mod:0' shape=(?, 1) dtype=float32>, 'item_city': <tf.Tensor 'lambda_3/mod:0' shape=(?, 1) dtype=float32>, 'channel': <tf.Tensor 'lambda_4/mod:0' shape=(?, 1) dtype=float32>, 'music_id': <tf.Tensor 'lambda_5/mod:0' shape=(?, 1) dtype=float32>, 'device': <tf.Tensor 'lambda_6/mod:0' shape=(?, 1) dtype=float32>}
[preprocess_input_embedding] sequence_input_dict: {}


[get_inputs_embedding] deep_sparse_emb_dict: {'uid': <tensorflow.python.keras.layers.embeddings.Embedding object at 0x7efec08b2860>, 'item_id': <tensorflow.python.keras.layers.embeddings.Embedding object at 0x7efec08b2e48>, 'author_id': <tensorflow.python.keras.layers.embeddings.Embedding object at 0x7efec08c0128>, 'item_city': <tensorflow.python.keras.layers.embeddings.Embedding object at 0x7efec08c01d0>, 'channel': <tensorflow.python.keras.layers.embeddings.Embedding object at 0x7efec08c0390>, 'music_id': <tensorflow.python.keras.layers.embeddings.Embedding object at 0x7efec08c0400>, 'device': <tensorflow.python.keras.layers.embeddings.Embedding object at 0x7efec08c04a8>}
[get_inputs_embedding] deep_emb_list after sparse_input_dict: [<tf.Tensor 'sparse_emb_0-uid/embedding_lookup/Identity_1:0' shape=(?, 1, 4) dtype=float32>, <tf.Tensor 'sparse_emb_1-item_id/embedding_lookup/Identity_1:0' shape=(?, 1, 4) dtype=float32>, <tf.Tensor 'sparse_emb_2-author_id/embedding_lookup/Identity_1:0' shape=(?, 1, 4) dtype=float32>, <tf.Tensor 'sparse_emb_3-item_city/embedding_lookup/Identity_1:0' shape=(?, 1, 4) dtype=float32>, <tf.Tensor 'sparse_emb_4-channel/embedding_lookup/Identity_1:0' shape=(?, 1, 4) dtype=float32>, <tf.Tensor 'sparse_emb_5-music_id/embedding_lookup/Identity_1:0' shape=(?, 1, 4) dtype=float32>, <tf.Tensor 'sparse_emb_6-device/embedding_lookup/Identity_1:0' shape=(?, 1, 4) dtype=float32>]
[get_inputs_embedding] deep_emb_list after dense_input_dict: [<tf.Tensor 'sparse_emb_0-uid/embedding_lookup/Identity_1:0' shape=(?, 1, 4) dtype=float32>, <tf.Tensor 'sparse_emb_1-item_id/embedding_lookup/Identity_1:0' shape=(?, 1, 4) dtype=float32>, <tf.Tensor 'sparse_emb_2-author_id/embedding_lookup/Identity_1:0' shape=(?, 1, 4) dtype=float32>, <tf.Tensor 'sparse_emb_3-item_city/embedding_lookup/Identity_1:0' shape=(?, 1, 4) dtype=float32>, <tf.Tensor 'sparse_emb_4-channel/embedding_lookup/Identity_1:0' shape=(?, 1, 4) dtype=float32>, <tf.Tensor 'sparse_emb_5-music_id/embedding_lookup/Identity_1:0' shape=(?, 1, 4) dtype=float32>, <tf.Tensor 'sparse_emb_6-device/embedding_lookup/Identity_1:0' shape=(?, 1, 4) dtype=float32>, <tf.Tensor 'reshape/Reshape:0' shape=(?, 1, 4) dtype=float32>]


[get_inputs_embedding] linear_sparse_emb_dict: {'uid': <tensorflow.python.keras.layers.embeddings.Embedding object at 0x7efec018a3c8>, 'item_id': <tensorflow.python.keras.layers.embeddings.Embedding object at 0x7efec018a278>, 'author_id': <tensorflow.python.keras.layers.embeddings.Embedding object at 0x7efec0137630>, 'item_city': <tensorflow.python.keras.layers.embeddings.Embedding object at 0x7efec0137710>, 'channel': <tensorflow.python.keras.layers.embeddings.Embedding object at 0x7efec01374e0>, 'music_id': <tensorflow.python.keras.layers.embeddings.Embedding object at 0x7efec0137780>, 'device': <tensorflow.python.keras.layers.embeddings.Embedding object at 0x7efec0137828>}
[get_inputs_embedding] linear_emb_list: [<tf.Tensor 'linear_emb_0-uid/embedding_lookup/Identity_1:0' shape=(?, 1, 1) dtype=float32>, <tf.Tensor 'linear_emb_1-item_id/embedding_lookup/Identity_1:0' shape=(?, 1, 1) dtype=float32>, <tf.Tensor 'linear_emb_2-author_id/embedding_lookup/Identity_1:0' shape=(?, 1, 1) dtype=float32>, <tf.Tensor 'linear_emb_3-item_city/embedding_lookup/Identity_1:0' shape=(?, 1, 1) dtype=float32>, <tf.Tensor 'linear_emb_4-channel/embedding_lookup/Identity_1:0' shape=(?, 1, 1) dtype=float32>, <tf.Tensor 'linear_emb_5-music_id/embedding_lookup/Identity_1:0' shape=(?, 1, 1) dtype=float32>, <tf.Tensor 'linear_emb_6-device/embedding_lookup/Identity_1:0' shape=(?, 1, 1) dtype=float32>]


[preprocess_input_embedding] linear_emb_list: [<tf.Tensor 'linear_emb_0-uid/embedding_lookup/Identity_1:0' shape=(?, 1, 1) dtype=float32>, <tf.Tensor 'linear_emb_1-item_id/embedding_lookup/Identity_1:0' shape=(?, 1, 1) dtype=float32>, <tf.Tensor 'linear_emb_2-author_id/embedding_lookup/Identity_1:0' shape=(?, 1, 1) dtype=float32>, <tf.Tensor 'linear_emb_3-item_city/embedding_lookup/Identity_1:0' shape=(?, 1, 1) dtype=float32>, <tf.Tensor 'linear_emb_4-channel/embedding_lookup/Identity_1:0' shape=(?, 1, 1) dtype=float32>, <tf.Tensor 'linear_emb_5-music_id/embedding_lookup/Identity_1:0' shape=(?, 1, 1) dtype=float32>, <tf.Tensor 'linear_emb_6-device/embedding_lookup/Identity_1:0' shape=(?, 1, 1) dtype=float32>]


[xdeepfm] deep_emb_list: [<tf.Tensor 'sparse_emb_0-uid/embedding_lookup/Identity_1:0' shape=(?, 1, 4) dtype=float32>, <tf.Tensor 'sparse_emb_1-item_id/embedding_lookup/Identity_1:0' shape=(?, 1, 4) dtype=float32>, <tf.Tensor 'sparse_emb_2-author_id/embedding_lookup/Identity_1:0' shape=(?, 1, 4) dtype=float32>, <tf.Tensor 'sparse_emb_3-item_city/embedding_lookup/Identity_1:0' shape=(?, 1, 4) dtype=float32>, <tf.Tensor 'sparse_emb_4-channel/embedding_lookup/Identity_1:0' shape=(?, 1, 4) dtype=float32>, <tf.Tensor 'sparse_emb_5-music_id/embedding_lookup/Identity_1:0' shape=(?, 1, 4) dtype=float32>, <tf.Tensor 'sparse_emb_6-device/embedding_lookup/Identity_1:0' shape=(?, 1, 4) dtype=float32>, <tf.Tensor 'reshape/Reshape:0' shape=(?, 1, 4) dtype=float32>]
[xdeepfm] linear_logit: Tensor("add_1/add:0", shape=(?, 1, 1), dtype=float32, device=/device:CPU:0)
[xdeepfm] inputs_list: [<tf.Tensor 'sparse_0-uid:0' shape=(?, 1) dtype=float32>, <tf.Tensor 'sparse_1-item_id:0' shape=(?, 1) dtype=float32>, <tf.Tensor 'sparse_2-author_id:0' shape=(?, 1) dtype=float32>, <tf.Tensor 'sparse_3-item_city:0' shape=(?, 1) dtype=float32>, <tf.Tensor 'sparse_4-channel:0' shape=(?, 1) dtype=float32>, <tf.Tensor 'sparse_5-music_id:0' shape=(?, 1) dtype=float32>, <tf.Tensor 'sparse_6-device:0' shape=(?, 1) dtype=float32>, <tf.Tensor 'dense_0-duration_time:0' shape=(?, 1) dtype=float32>]
WARNING:tensorflow:From /home/appops/lijianwei1/icme_keras/deepctr/layers/interaction.py:294: calling reduce_sum (from tensorflow.python.ops.math_ops) with keep_dims is deprecated and will be removed in a future version.
Instructions for updating:
keep_dims is deprecated, use keepdims instead
WARNING:tensorflow:From /home/appops/lijianwei1/icme_keras/deepctr/layers/interaction.py:294: calling reduce_sum (from tensorflow.python.ops.math_ops) with keep_dims is deprecated and will be removed in a future version.
Instructions for updating:
keep_dims is deprecated, use keepdims instead
==== after model build ===
ngpus: 5
epochs: 100
batch_size: 20480
train_steps_per_epoch: 11718
Epoch 1/1
/home/appops/Python/lib/python3.6/site-packages/tensorflow/python/ops/gradients_impl.py:97: UserWarning: Converting sparse IndexedSlices to a dense Tensor with 128000000 elements. This may consume a large amount of memory.
  num_elements)
 - 6061s - loss: 4.8119 - finish_loss: 4.5548 - like_loss: 0.2564
2019-03-01 23:35:57.913754: W tensorflow/core/common_runtime/bfc_allocator.cc:219] Allocator (GPU_0_bfc) ran out of memory trying to allocate 3.79GiB. The caller indicates that this is not a failure, but may mean that there could be performance gains if more memory were available.
epoch:0, finish auc: 0.4959467601736026, like auc: 0.4877822983106419
Epoch 1/1
 - 5999s - loss: 4.8116 - finish_loss: 4.5552 - like_loss: 0.2564
epoch:1, finish auc: 0.49803489775527704, like auc: 0.4863129958186463
Epoch 1/1
 - 5991s - loss: 4.8116 - finish_loss: 4.5552 - like_loss: 0.2564
epoch:2, finish auc: 0.50033789173446, like auc: 0.48318145708388843
Epoch 1/1
 - 5979s - loss: 4.8116 - finish_loss: 4.5552 - like_loss: 0.2564
epoch:3, finish auc: 0.5056089533255024, like auc: 0.4756442639386741
Epoch 1/1
 - 5998s - loss: 4.8116 - finish_loss: 4.5552 - like_loss: 0.2564
epoch:4, finish auc: 0.507801438776121, like auc: 0.4731971129198037
Epoch 1/1
 - 5998s - loss: 4.8116 - finish_loss: 4.5551 - like_loss: 0.2564
epoch:5, finish auc: 0.504088894561005, like auc: 0.4738803197304439
Epoch 1/1
 - 5996s - loss: 4.8116 - finish_loss: 4.5552 - like_loss: 0.2564
epoch:6, finish auc: 0.4994591566907892, like auc: 0.4795544555924661
Epoch 1/1
 - 6033s - loss: 4.8116 - finish_loss: 4.5552 - like_loss: 0.2564
epoch:7, finish auc: 0.4985772782911845, like auc: 0.47980945011127846
Epoch 1/1
 - 6004s - loss: 4.8116 - finish_loss: 4.5552 - like_loss: 0.2564
epoch:8, finish auc: 0.4976668774310869, like auc: 0.4794902101927564
Epoch 1/1
 - 6005s - loss: 4.8116 - finish_loss: 4.5552 - like_loss: 0.2564
epoch:9, finish auc: 0.49807575539656546, like auc: 0.47915939128833157
Epoch 1/1
 - 6007s - loss: 4.8116 - finish_loss: 4.5552 - like_loss: 0.2564
epoch:10, finish auc: 0.4981406932280046, like auc: 0.4791296021321646
Epoch 1/1
 - 5965s - loss: 4.8116 - finish_loss: 4.5551 - like_loss: 0.2564
epoch:11, finish auc: 0.498192504695666, like auc: 0.4790758319472673
Epoch 1/1
 - 6179s - loss: 4.8116 - finish_loss: 4.5552 - like_loss: 0.2564
epoch:12, finish auc: 0.4982964062432285, like auc: 0.47914522213488747
Epoch 1/1
